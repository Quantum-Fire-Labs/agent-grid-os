<div class="dashboard">
  <div class="dashboard-header">
    <h1><%= @custom_app.name %> Settings</h1>
    <div class="dashboard-actions">
      <%= link_to "Back to App", custom_app_path(@custom_app), class: "btn btn-ghost" %>
    </div>
  </div>

  <div class="settings-section">
    <div class="settings-section-header">
      <h2 class="settings-section-title">Assigned Users</h2>
    </div>

    <% if @custom_app_users.any? %>
      <div class="user-list">
        <% @custom_app_users.each do |custom_app_user| %>
          <% user = custom_app_user.user %>
          <div class="user-row">
            <div class="user-row-left">
              <div class="user-avatar"><%= user.first_name[0] %><%= user.last_name[0] %></div>
              <div class="user-row-info">
                <span class="user-row-name">
                  <%= user.first_name %> <%= user.last_name %>
                  <span class="user-badge-role user-badge-role-<%= user.role %>"><%= user.role.capitalize %></span>
                </span>
                <span class="user-row-email"><%= user.email_address %></span>
              </div>
            </div>
            <div class="user-row-right">
              <%= button_to "Remove", custom_app_user_path(@custom_app, custom_app_user), method: :delete, class: "btn btn-ghost btn-sm text-danger", data: { turbo_confirm: "Remove #{user.first_name} from #{@custom_app.name}?" } %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="settings-empty">No users assigned. All users with agent access can use this app.</p>
    <% end %>
  </div>

  <% if @available_users.any? %>
    <div class="settings-section">
      <div class="settings-section-header">
        <h2 class="settings-section-title">Add Users</h2>
      </div>

      <div class="user-list">
        <% @available_users.each do |user| %>
          <div class="user-row">
            <div class="user-row-left">
              <div class="user-avatar"><%= user.first_name[0] %><%= user.last_name[0] %></div>
              <div class="user-row-info">
                <span class="user-row-name">
                  <%= user.first_name %> <%= user.last_name %>
                  <span class="user-badge-role user-badge-role-<%= user.role %>"><%= user.role.capitalize %></span>
                </span>
                <span class="user-row-email"><%= user.email_address %></span>
              </div>
            </div>
            <div class="user-row-right">
              <%= button_to "Add", custom_app_users_path(@custom_app, user_id: user.id), method: :post, class: "btn btn-primary btn-sm" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
