<div class="dashboard">
  <div class="dashboard-header">
    <div class="breadcrumb">
      <%= link_to "Agents", agents_path %> <span class="breadcrumb-sep">/</span> <span>New agent</span>
    </div>
  </div>

  <% unless @from_persona %>
    <div class="form-card persona-chooser">
      <div class="form-card-header">
        <h1>Create a new agent</h1>
        <p class="form-card-subtitle">Start from scratch or choose a persona template.</p>
      </div>

      <div class="personality-grid persona-grid">
        <% @personas.each do |persona| %>
          <%= link_to new_agent_path(persona: persona.name), class: "personality-option persona-link" do %>
            <span class="personality-card">
              <span class="personality-name"><%= persona.title %></span>
              <span class="personality-desc"><%= persona.description.truncate(100) %></span>
            </span>
          <% end %>
        <% end %>
      </div>

      <p class="form-hint persona-chooser-hint">Or configure a custom agent below.</p>
    </div>
  <% end %>

  <div class="form-card">
    <div class="form-card-header">
      <% if @from_persona %>
        <h1>New agent from <%= @from_persona.title %></h1>
        <p class="form-card-subtitle">
          Pre-filled from persona template. All fields are editable.
          <%= link_to "Choose a different option", new_agent_path %>.
        </p>
      <% else %>
        <h1>Custom agent</h1>
        <p class="form-card-subtitle">Give your agent a name and personality to get started.</p>
      <% end %>
    </div>

    <% if @agent.errors.any? %>
      <div class="flash flash-alert">
        <%= @agent.errors.full_messages.to_sentence %>
      </div>
    <% end %>

    <%= form_with model: @agent, class: "form-body" do |form| %>
      <% if @from_persona %>
        <input type="hidden" name="from_persona" value="<%= @from_persona.name %>">
      <% end %>

      <div class="form-group">
        <%= form.label :name, "Agent name" %>
        <%= form.text_field :name, required: true, autofocus: true, placeholder: "e.g. dash, atlas, scout", autocomplete: "off" %>
        <p class="form-hint">Lowercase, no spaces. This is the agent's system identifier.</p>
      </div>

      <div class="form-group">
        <%= form.label :title, "Title / role (optional)" %>
        <%= form.text_field :title, placeholder: "e.g. the DJ, research assistant" %>
      </div>

      <% unless @from_persona %>
        <fieldset class="form-group">
          <legend class="form-legend">Personality</legend>
          <div class="personality-grid">
            <label class="personality-option">
              <%= form.radio_button :personality, "witty", checked: true %>
              <span class="personality-card">
                <span class="personality-name">Dry & witty</span>
                <span class="personality-desc">Self-deprecating humor, leans into the absurdity of being an AI</span>
              </span>
            </label>
            <label class="personality-option">
              <%= form.radio_button :personality, "professional" %>
              <span class="personality-card">
                <span class="personality-name">Professional</span>
                <span class="personality-desc">Clear, direct, focused on getting things done</span>
              </span>
            </label>
            <label class="personality-option">
              <%= form.radio_button :personality, "friendly" %>
              <span class="personality-card">
                <span class="personality-name">Friendly</span>
                <span class="personality-desc">Warm, conversational, encouraging</span>
              </span>
            </label>
            <label class="personality-option">
              <%= form.radio_button :personality, "none" %>
              <span class="personality-card">
                <span class="personality-name">Minimal</span>
                <span class="personality-desc">No preset personality â€” start blank</span>
              </span>
            </label>
          </div>
        </fieldset>
      <% end %>

      <div class="form-group">
        <%= form.label :description, "Description (optional)" %>
        <%= form.text_field :description, placeholder: "Brief description of what this agent does" %>
      </div>

      <div class="form-group">
        <%= form.label :instructions, "Instructions (optional)" %>
        <%= form.textarea :instructions, rows: 6, placeholder: "Custom instructions included in every prompt to this agent" %>
      </div>

      <div class="form-actions">
        <%= form.submit "Create agent", class: "btn btn-primary" %>
        <%= link_to "Cancel", agents_path, class: "btn btn-ghost" %>
      </div>
    <% end %>
  </div>
</div>
