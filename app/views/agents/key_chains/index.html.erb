<div class="agent-profile" data-status="<%= @agent.status %>">
  <%= render "agents/header", active_tab: "keychains" %>

  <div class="agent-profile-body">
    <div class="agent-detail-section">
      <div class="settings-section-header">
        <h3 class="section-label">Agent Keychains</h3>
        <%= link_to "Add keychain", new_agent_key_chain_path(@agent), class: "btn btn-primary btn-sm" %>
      </div>

      <% if @key_chains.any? %>
        <div class="provider-list">
          <% @key_chains.each do |key_chain| %>
            <div class="provider-row">
              <div class="provider-info">
                <span class="provider-name"><%= key_chain.name %></span>
                <span class="provider-model secret-masked">••••••••</span>
                <% if key_chain.sandbox_accessible? %>
                  <span class="provider-badge">Sandbox</span>
                <% end %>
              </div>
              <div class="provider-meta">
                <div class="provider-actions">
                  <%= link_to "Edit", edit_agent_key_chain_path(@agent, key_chain), class: "btn btn-ghost btn-xs" %>
                  <%= button_to "Remove", agent_key_chain_path(@agent, key_chain), method: :delete, class: "btn btn-ghost btn-xs text-danger", data: { turbo_confirm: "Remove this keychain?" } %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="settings-empty">No agent-specific keychains. Add one or use account-level keychains below.</p>
      <% end %>
    </div>

    <% if @account_key_chains.any? %>
      <div class="agent-detail-section">
        <h3 class="section-label">Inherited (Account)</h3>
        <div class="provider-list">
          <% agent_names = @key_chains.pluck(:name) %>
          <% @account_key_chains.each do |key_chain| %>
            <div class="provider-row">
              <div class="provider-info">
                <span class="provider-name"><%= key_chain.name %></span>
                <span class="provider-model secret-masked">••••••••</span>
                <% if key_chain.sandbox_accessible? %>
                  <span class="provider-badge">Sandbox</span>
                <% end %>
                <% if agent_names.include?(key_chain.name) %>
                  <span class="provider-badge provider-badge-secondary">Overridden</span>
                <% end %>
              </div>
              <div class="provider-meta">
                <span class="text-muted">Account-level</span>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
