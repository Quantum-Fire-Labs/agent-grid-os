<div class="dashboard">
  <div class="dashboard-header">
    <h1>Agents</h1>
    <div class="dashboard-actions">
      <div class="view-toggle" data-controller="view-toggle">
      <button class="view-toggle-btn active" data-view="grid" data-action="click->view-toggle#switch" aria-label="Grid view">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="1" y="1" width="7" height="7" rx="1.5"/>
          <rect x="10" y="1" width="7" height="7" rx="1.5"/>
          <rect x="1" y="10" width="7" height="7" rx="1.5"/>
          <rect x="10" y="10" width="7" height="7" rx="1.5"/>
        </svg>
      </button>
      <button class="view-toggle-btn" data-view="list" data-action="click->view-toggle#switch" aria-label="List view">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.5">
          <line x1="1" y1="4" x2="17" y2="4"/>
          <line x1="1" y1="9" x2="17" y2="9"/>
          <line x1="1" y1="14" x2="17" y2="14"/>
        </svg>
      </button>
      </div>
      <%= link_to new_agent_path, class: "btn btn-primary btn-icon", aria: { label: "New agent" } do %>
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="9" y1="4" x2="9" y2="14"/><line x1="4" y1="9" x2="14" y2="9"/></svg>
      <% end %>
    </div>
  </div>

  <% if @agents.any? %>
    <div class="agents-grid" data-view-toggle-target="container">
      <% @agents.each do |agent| %>
        <div class="agent-card">
          <%= link_to agent_path(agent), class: "agent-card-link" do %>
            <div class="agent-card-header">
              <h3 class="agent-name"><%= agent.name %></h3>
              <span class="agent-status status-<%= agent.status || 'asleep' %>"><%= agent.status || "suspended" %></span>
            </div>
            <% if agent.title.present? %>
              <p class="agent-title"><%= agent.title %></p>
            <% end %>
            <% if agent.description.present? %>
              <p class="agent-description"><%= truncate(agent.description, length: 120) %></p>
            <% end %>
          <% end %>
          <div class="agent-card-footer">
            <span class="agent-network-mode"><%= agent.network_mode || "none" %></span>
            <% if agent.running? %>
              <%= link_to "Chat", chat_path(agent.conversations.find_or_create_direct(Current.user)), class: "btn btn-primary btn-xs" %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="empty-state">
      <h2>No agents yet</h2>
      <p>Create your first agent to get started.</p>
    </div>
  <% end %>
</div>
